
#SET{resultats,#ARRAY}
<B_recherchebrute>
<BOUCLE_recherchebrute(ARTICLES){recherche}{!par points}{0,20}>
  #SET{source,#ID_ARTICLE}
  #SET{article,#ID_ARTICLE}
  #SET{articles,""}
  #SET{points,#POINTS}
  #SET{existe,""}
  <BOUCLE_rubniv(RUBRIQUES){id_rubrique}>#SET{rang,#RANG}
      <BOUCLE_art_source2(ARTICLES){id_rubrique=#ID_PARENT}>
        [(#RANG|=={#GET{rang}}|oui)
          #SET{source,#ID_ARTICLE}
        ]
      </BOUCLE_art_source2>
  </BOUCLE_rubniv>
  [(#POINTS|>{2}|oui)
    [(#GET{resultats}|table_valeur{artsrc#GET{source}}|oui)
      #SET{existe,"existe"}
      #SET{article,#GET{resultats}|table_valeur{artsrc#GET{source}}|table_valeur{article}}
      [(#ID_ARTICLE|=={#GET{source}}|non)
        [(#GET{resultats}|table_valeur{artsrc#GET{source}}|table_valeur{articles}|oui)
          #SET{articles,#GET{resultats}|table_valeur{artsrc#GET{source}}|table_valeur{articles}|concat{", ",#ID_ARTICLE}}
        ]
        [(#GET{resultats}|table_valeur{artsrc#GET{source}}|table_valeur{articles}|non)
          #SET{articles,#GET{resultats}|table_valeur{artsrc#GET{source}}|table_valeur{articles}|concat{#ID_ARTICLE}}
        ]
      ]
      #SET{source,#GET{source}}
      #SET{points,#GET{resultats}|table_valeur{artsrc#GET{source}}|table_valeur{points}}
    ]
    #SET{resultats, #GET{resultats}|array_merge{#ARRAY{artsrc#GET{source},#ARRAY{articlesource,#GET{source},article,#GET{article},articles,#GET{articles},points,#GET{points}}}}}
  ]
</BOUCLE_recherchebrute>
</B_recherchebrute>

<B_recherche>
[(#REM)<h2 class="liste_reponse">Nos r√©ponses : #ENV{recherche}</h2>]
[(#REM)<h3>[(#GET{resultats}|print_r{1})]</h3>]
<ul class="liste_reponse surlignable">
<BOUCLE_recherche(DATA){source tableau, #GET{resultats}}{!par points}>
  <BOUCLE_article(ARTICLES){id_article=#VALEUR{articlesource}}>
    <li class="niv1">
      [(#ARTICLE|!={#ARTICLESOURCE}|?{" ",""})
      <a href='#URL_ARTICLE#titre#ARTICLE'>#INFO_TITRE{article,#ARTICLE}<em style="font-size:0.5em;font-weight:200;margin-left:0.5em;vertical-align:top;">#VALEUR{points}pts</em></a>
      <div class="rechprinc">#TITRE</div>
      [<div class="texte">(#INFO_CHAPO{article,#VALEUR{article}}|?{#INFO_CHAPO{article,#VALEUR{article}}|couper{140}, #INFO_TEXTE{article,#VALEUR{article}}|couper{140}})</div>]
      <div class="sousrech">
        <INCLURE{fond=inclure/sous-rech, articles=#ARTICLES, articlesource=#ARTICLESOURCE} />
      </div>
      ]
      [(#ARTICLE|!={#ARTICLESOURCE}|?{""," "})
      <a href='#URL_ARTICLE'>#TITRE<em style="font-size:0.5em;font-weight:200;margin-left:0.5em;vertical-align:top">#VALEUR{points}pts</em></a>
      [<div class="texte">(#INFO_CHAPO{article,#VALEUR{article}}|?{#INFO_CHAPO{article,#VALEUR{article}}|couper{320}, #INFO_TEXTE{article,#VALEUR{article}}|couper{320}})</div>]
      ]
    </li>
  </BOUCLE_article>
</BOUCLE_recherche>
</ul>
</B_recherche>
